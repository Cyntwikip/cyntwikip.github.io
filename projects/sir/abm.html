<html>
    <head>
        <title>Pandemic Simulation</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">
        <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
        <script type="text/javascript" src="js/abm.js"></script>
        <script type="text/javascript" src="js/utils.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    </head>

    <body>
        <!-- <label>Infection Rate: </label><input id="infectionRate"> -->

        <div style="width: 800px; margin: 0 auto;">

            <div class="columns" style="width: 800px; margin: 20px;">
                <div class="column">
                    <div class="field is-horizontal">
                        <label class="label">Infection Rate</label>
                        <input id="infectionRate" class="input is-rounded" type="number" step=0.01 placeholder="Infection Rate" value=0.8 max=1 min=0>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Number of People</label>
                        <input id="nPeople" class="input is-rounded" type="number" placeholder="Number of People" value=300>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Number of Hospitals</label>
                        <input id="nHospitals" class="input is-rounded" type="number" placeholder="Number of Hospitals" value=1>
                    </div>
                </div>
                <div class="column">
                    <div class="field is-horizontal">
                        <label class="label">Asymptomatic Probability</label>
                        <input id="pAsymptomatic" class="input is-rounded" type="number" step=0.01 placeholder="Asymptomatic Probability" value=0.3 max=1 min=0>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Number of Houses</label>
                        <input id="nHouses" class="input is-rounded" type="number" placeholder="Number of Houses" value=30>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Number of Supermarkets</label>
                        <input id="nSupermarkets" class="input is-rounded" type="number" placeholder="Number of Supermarkets" value=1>
                    </div>
                </div>
                <div class="column">
                    <div class="field is-horizontal">
                        <label class="label">Incubation Period (hrs)</label>
                        <input id="incubationPeriod" class="input is-rounded" type="number" placeholder="Incubation Period" value=24>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Recovery Rate</label>
                        <input id="pRecovery" class="input is-rounded" type="number" step=0.001 placeholder="Recovery Rate" value=0.007 max=1 min=0>
                    </div>
                    <div class="field is-horizontal">
                        <label class="label">Death Rate</label>
                        <input id="pDeath" class="input is-rounded" type="number" step=0.001 placeholder="Death Rate" value=0.003 max=1 min=0>
                    </div>
                </div>
            </div>

            <div class="buttons" style="margin: 0 auto; width: 0px;">
                <button id="btnRun" class="button is-primary">Run</button>
                <button onclick="reset();" class="button is-danger">Reset</button>
            </div>

            <div class="chart-container" style="position:relative; width:600px;"></div>
                <canvas id="myChart" height="400" width="800"></canvas>
            </div>

            <div class="buttons" style="margin: 0 auto; width: 0px;">
                <button onclick="iterate();" class="button is-warning">Add</button>
            </div>
        </div>
    </body>
    <script>
        let data = {
				labels: this.historyHours,
				datasets: [{
					label: 'Infected',
					borderColor: window.chartColors.red,
					backgroundColor: window.chartColors.red,
					data: historyInfected,
				}, {
					label: 'Exposed',
					borderColor: window.chartColors.yellow,
					backgroundColor: window.chartColors.yellow,
					data: historyExposed,
				}, {
					label: 'Susceptible',
					borderColor: window.chartColors.blue,
					backgroundColor: window.chartColors.blue,
					data: historySusceptible,
				},  {
					label: 'Recovered',
					borderColor: window.chartColors.green,
					backgroundColor: window.chartColors.green,
					data: historyRecovered,
				}]
			}

        let options = {
                animation: false,
                parsing: false,
                responsive: false,
                // maintainAspectRatio: false,
				title: {
					display: true,
					text: 'Pandemic Simulation'
				},
				tooltips: {
					mode: 'index',
				},
				hover: {
					mode: 'index'
				},
				scales: {
					xAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Hour'
						}
					}],
					yAxes: [{
						stacked: true,
						scaleLabel: {
							display: true,
							labelString: 'Counts'
						}
					}]
                },
                // elements: {
                //     line: {
                //         tension: 0 // disables bezier curves
                //     }
                // }
			}

        let ctx = document.getElementById('myChart').getContext('2d');

        let stackedLine = new Chart(ctx, {
            type: 'line',
            data: data,
            options: options
        });

        // iterate();

        let btn = document.getElementById('btnRun');

        btn.addEventListener('click', () => {
            btn.disabled = true;

            let value = parseFloat(document.getElementById('infectionRate').value);
            infectionRate = value ? value: infectionRate; 
            value = parseFloat(document.getElementById('pAsymptomatic').value);
            pAsymptomatic = value ? value: pAsymptomatic; 
            
            value = parseInt(document.getElementById('incubationPeriod').value);
            incubationPeriod = value ? value: incubationPeriod; 
            value = parseFloat(document.getElementById('pRecovery').value);
            pRecovery = value ? value: pRecovery; 
            value = parseFloat(document.getElementById('pDeath').value);
            pDeath = value ? value: pDeath; 

            value = document.getElementById('nPeople').value;   
            nPeople = value ? parseInt(value): null; 
            value = document.getElementById('nHouses').value;
            nHouses = value ? parseInt(value): null; 
            value = document.getElementById('nHospitals').value;
            nHospitals = value ? parseInt(value): null; 
            value = document.getElementById('nSupermarkets').value;
            nSupermarkets = value ? parseInt(value): null; 

            let timer = setInterval(iterate, 5);
            function stopTimer() {
                clearInterval(timer);
                btn.disabled = false;
            }
            setTimeout(stopTimer, 5000);
            
        });
    </script>
</html>